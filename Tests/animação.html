<!doctype html>
<html lang="pt-br">
<head>
	<meta charset="utf-8" />
    <title>Animação</title>
	<script type="text/javascript" src="../js/phaser.min.js"></script>
    <style type="text/css">
        body {
            margin: 0;
        }
    </style>
</head>
<body>

<script type="text/javascript">

var game = new Phaser.Game(1080, 720, Phaser.AUTO, '', { preload: preload, create: create, update: update });

function preload() {
    game.load.image('ground', '../assets/platform.png');
    game.load.spritesheet('robo', '../assets/robo_verde.png', 101, 101);
}

var player;
var puloR;
var puloL;
var direcao = "R";
var cursors;

function create() {

    //  We're going to be using physics, so enable the Arcade Physics system
    game.physics.startSystem(Phaser.Physics.ARCADE);

    //  The platforms group contains the ground and the 2 ledges we can jump on
    platforms = game.add.group();

    //  We will enable physics for any object that is created in this group
    platforms.enableBody = true;

		// Here we create the ground.
    var ground = platforms.create(0, game.world.height-20, 'ground');

    //  Scale it to fit the width of the game (the original sprite is 400x32 in size)
    ground.scale.setTo(2, 2);

    //  This stops it from falling away when you jump on it
    ground.body.immovable = true;

    // The player and its settings
    player = game.add.sprite(5, game.world.height-200, 'robo');
	player.scale.set(.65);

    //  We need to enable physics on the player
    game.physics.arcade.enable(player);

    //  Player physics properties. Give the little guy a slight bounce.
    player.body.gravity.y = 2000;
    player.body.collideWorldBounds = true;

    //  Our two animations, walking left and right.
	direita = player.animations.add('right', [1,0,1,0,2,3,2,3], 9, true);
    esquerda = player.animations.add('left', [5,4,5,4,6,7,6,7], 9, true);
	puloR = player.animations.add('upR', [9,10,10,11,11,8,0], 25, true);
	puloL = player.animations.add('upL', [13,14,14,15,15,12,4], 25, true);
    //  Our controls.
    cursors = game.input.keyboard.createCursorKeys();

	player.frame = 1;
}

function update() {
	//  Collide the player and the stars with the platforms
	game.physics.arcade.collide(player, platforms);

    //  Reset the players velocity (movement)
    player.body.velocity.x = 0;

		if (cursors.right.isDown && !cursors.left.isDown){
        //  Move to the right
				direcao = "R";
				player.body.velocity.x = 110;
				if (!(puloR.isPlaying || puloL.isPlaying)) {
						player.animations.play('right', false, false);
				}
		} else {
				direita.onComplete.add(function () {
					player.animations.stop('right',true, true);
					player.frame = 0;
				}, player);
		}

		if (cursors.left.isDown && !cursors.right.isDown ){
        //  Move to the left
				direcao = "L";
				player.body.velocity.x = -110;
				if (!(puloL.isPlaying || puloR.isPlaying)) {
						player.animations.play('left', false, false);
				}
    } else {
				esquerda.onComplete.add(function () {
					player.animations.stop('left',true, true);
					player.frame = 4;}, player);
		}

		//  Allow the player to jump if they are touching the ground.
    if (cursors.up.isDown && player.body.touching.down){
			  if (!(puloR.isPlaying || puloL.isPlaying)) {
					player.body.velocity.y = -700;
					switch (direcao) {
						case "R":
							player.animations.play('upR',false, false);
							break;
				 		case "L":
					 		player.animations.play('upL',false, false);
				 			break;
						default:
					  	break;
				}
			 }
    } else {
			switch (direcao) {
				case "R":
					puloR.onComplete.add(function () {
						player.animations.stop('upR',true, true);}, player);
					break;
				case "L":
					puloL.onComplete.add(function () {
						player.animations.stop('upL',true, true);}, player);
					break;
				default:
					break;
			}
		}
}

</script>

</body>
</html>
